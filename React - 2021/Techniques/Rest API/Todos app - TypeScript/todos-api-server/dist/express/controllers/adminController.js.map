{"version":3,"file":"adminController.js","sourceRoot":"","sources":["../../../src/express/controllers/adminController.ts"],"names":[],"mappings":";;;;;AAGA,sDAA8B;AAE9B,8FAAsE;AACtE,0FAAkE;AAClE,4FAAoE;AAEpE,qEAA6D;AAE7D,0EAA0D;AAC1D,sEAAsD;AAEtD,oEAAiD;AAEjD,MAAM,eAAe;IAKnB;QA8CQ,aAAQ,GAAG,KAAK,EAAE,GAAoB,EAAE,GAAqB,EAAiB,EAAE;YACtF,IAAI;gBACF,MAAM,KAAK,GAAG,MAAM,cAAS,CAAC,eAAe,CAAC,EAAE,GAAG,GAAG,CAAC,KAAK,EAAE,CAAC,CAAC;gBAChE,iBAAe,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,mBAAmB,EAAE,KAAK,CAAC,CAAC;aAC5D;YAAC,OAAO,KAAK,EAAE;gBACd,IAAI,KAAK,YAAY,KAAK,EAAE;oBAC1B,eAAa,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,IAAI,EAAE,KAAK,CAAC,CAAC;iBAC3C;aACF;QACH,CAAC,CAAC;QAEM,YAAO,GAAG,KAAK,EAAE,GAAoB,EAAE,GAAqB,EAAiB,EAAE;YACrF,IAAI;gBACF,MAAM,UAAU,GAAG,IAAI,cAAS,CAAC,EAAE,GAAG,GAAG,CAAC,IAAI,EAAE,CAAC,CAAC;gBAElD,MAAM,WAAW,GAAG,MAAM,UAAU,CAAC,gBAAgB,EAAE,CAAC;gBAExD,IAAI,WAAW,EAAE;oBACf,MAAM,eAAe,GAAG,CAAC;4BACvB,KAAK,EAAE,UAAU,CAAC,KAAK;4BACvB,GAAG,EAAE,cAAc;4BACnB,KAAK,EAAE,OAAO;4BACd,QAAQ,EAAE,MAAM;yBACjB,CAAC,CAAC;oBACH,eAAa,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,cAAc,EAAE,eAAe,CAAC,CAAC;oBAC9D,OAAO;iBACR;gBAED,MAAM,UAAU,CAAC,IAAI,EAAE,CAAC;gBAExB,iBAAe,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,kBAAkB,CAAC,CAAC;aACpD;YAAC,OAAO,KAAK,EAAE;gBACd,IAAI,KAAK,YAAY,KAAK,EAAE;oBAC1B,eAAa,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,IAAI,EAAE,KAAK,CAAC,CAAC;iBAC3C;aACF;QACH,CAAC,CAAC;QAjFA,IAAI,CAAC,MAAM,GAAG,iBAAO,CAAC,MAAM,EAAE,CAAC;IACjC,CAAC;IAEO,SAAS;QAef,IAAI,CAAC,MAAM,CAAC,GAAG,CACb,QAAQ,EACR,CAAC,8BAAoB,EAAE,4BAAkB,CAAC,EAC1C,IAAI,CAAC,QAAQ,CACd,CAAC;QAgBF,IAAI,CAAC,MAAM,CAAC,IAAI,CACd,WAAW,EACX,CAAC,8BAAoB,EAAE,6BAAmB,CAAC,cAAoB,CAAC,CAAC,EACjE,IAAI,CAAC,OAAO,CACb,CAAC;IACJ,CAAC;IAwCD,MAAM,CAAC,MAAM;QACX,IAAI,OAAO,IAAI,CAAC,UAAU,KAAK,WAAW,EAAE;YAC1C,IAAI,CAAC,UAAU,GAAG,IAAI,eAAe,EAAE,CAAC;YACxC,IAAI,CAAC,UAAU,CAAC,SAAS,EAAE,CAAC;SAC7B;QACD,OAAO,IAAI,CAAC,UAAU,CAAC,MAAM,CAAC;IAChC,CAAC;CACF;AAED,kBAAe,eAAe,CAAC","sourcesContent":["/* eslint-disable @typescript-eslint/no-unused-vars */\n/* eslint-disable max-len */\n\nimport express from 'express';\n\nimport checkMongoConnection from '../middleware/checkMongoConnection';\nimport validateGetRequest from '../middleware/validateGetRequest';\nimport validatePostRequest from '../middleware/validatePostRequest';\n\nimport userValidationSchema from '../validationSchemas/user';\n\nimport responseSuccess from '../responseHandlers/success';\nimport responseError from '../responseHandlers/error';\n\nimport UserModel from '../../mongo/schemas/user';\n\nclass AdminController {\n  private static controller: AdminController;\n\n  private router: express.Router;\n\n  private constructor() {\n    this.router = express.Router();\n  }\n\n  private configure(): void {\n    /*\n    curl -X GET -H \"Accept: application/json\" http://127.0.0.1:5000/admin/users/?searchFor1=firstName&searchTerm=s\n    curl -X GET -H \"Accept: application/json\" http://127.0.0.1:5000/admin/users/?searchFor=firstName&searchTerm=s\n    curl -X GET -H \"Accept: application/json\" http://127.0.0.1:5000/admin/users/?searchFor=firstName&searchTerm=p\n\n    curl -X GET -H \"Accept: application/json\" http://127.0.0.1:5000/admin/users/?sortBy=firstName&sortOrder=asc\n    curl -X GET -H \"Accept: application1/json\" http://127.0.0.1:5000/admin/users/?sortBy=firstName&sortOrder=asc\n    curl -X GET -H \"Accept: application/json\" http://127.0.0.1:5000/admin/users/?sortBy=createdAt&sortOrder=desc\n    curl -X GET -H \"Accept: application/json\" http://127.0.0.1:5000/admin/users/?searchFor=firstName&searchTerm=s\n    curl -X GET -H \"Accept: application/json\" http://127.0.0.1:5000/admin/users/?searchFor=lastName&searchTerm=k\n    curl -X GET -H \"Accept: application/json\" http://127.0.0.1:5000/admin/users/?searchFor=firstName&searchTerm=s&sortBy=firstName&sortOrder=asc\n    curl -X GET -H \"Accept: application/json\" http://127.0.0.1:5000/admin/users\n    curl -X GET -H \"Accept: application/json1\" http://127.0.0.1:5000/admin/users\n    */\n    this.router.get(\n      '/users',\n      [checkMongoConnection, validateGetRequest],\n      this.getUsers,\n    );\n\n    /*\n    curl -X POST --data '{\"firstName\":\"Sven\", \"lastName\":\"Kohn\", \"email\":\"sven@mindprobe.io\"}' -H \"Accept: application/json\" -H \"Content-Type: application/json1\" http://127.0.0.1:5000/admin/user/add\n    curl -X POST --data '{\"firstName\":\"Sven\", \"lastName\":\"Kohn\", \"email\":\"sven@mindprobe\"}' -H \"Accept: application/json\" -H \"Content-Type: application/json\" http://127.0.0.1:5000/admin/user/add\n    curl -X POST --data '{\"firstName\":\"Sven11 Michel-Ã±\", \"lastName\":\"Kohn\", \"email\":\"sven@mindprobe.io\"}' -H \"Accept: application/json\" -H \"Content-Type: application/json\" http://127.0.0.1:5000/admin/user/add\n    curl -X POST --data '{\"firstName\":\"Sven\", \"email\":\"sven@mindprobe.io\"}' -H \"Accept: application/json\" -H \"Content-Type: application/json\" http://127.0.0.1:5000/admin/user/add\n    curl -X POST --data '{\"firstName\":\"Sven\", \"lastName\":\"Kohn\", \"email\":\"SvEn@MIndprobe.io\"}' -H \"Accept: application/json\" -H \"Content-Type: application/json\" http://127.0.0.1:5000/admin/user/add\n    curl -X POST --data '{\"firstName\":\"Sven\", \"lastName\":\"Kohn\", \"email\":\"sven1@mindprobe.io\"}' -H \"Accept: application/json\" -H \"Content-Type: application/json\" http://127.0.0.1:5000/admin/user/add\n\n    curl -X POST --data '{\"firstName\":\"Sven\", \"lastName\":\"Kohn\", \"email\":\"sven@mindprobe.io\"}' -H \"Accept: application/json\" -H \"Content-Type: application/json\" http://127.0.0.1:5000/admin/user/add\n    curl -X POST --data '{\"firstName\":\"Simon\", \"lastName\":\"Weisberger\", \"email\":\"simon@mindprobe.io\"}' -H \"Accept: application/json\" -H \"Content-Type: application/json\" http://127.0.0.1:5000/admin/user/add\n    curl -X POST --data '{\"firstName\":\"Barbara\", \"lastName\":\"Massari Nola\", \"email\":\"barbara@mindprobe.io\"}' -H \"Accept: application/json\" -H \"Content-Type: application/json\" http://127.0.0.1:5000/admin/user/add\n    curl -X POST --data '{\"firstName\":\"Valentina\", \"lastName\":\"Kohn\", \"email\":\"valentina@mindprobe.io\"}' -H \"Accept: application/json\" -H \"Content-Type: application/json\" http://127.0.0.1:5000/admin/user/add\n    curl -X POST --data '{\"firstName\":\"Thomas\", \"lastName\":\"Kohn\", \"email\":\"thomas@mindprobe.io\"}' -H \"Accept: application/json\" -H \"Content-Type: application/json\" http://127.0.0.1:5000/admin/user/add\n    */\n    this.router.post(\n      '/user/add',\n      [checkMongoConnection, validatePostRequest(userValidationSchema)],\n      this.addUser,\n    );\n  }\n\n  private getUsers = async (req: express.Request, res: express.Response): Promise<void> => {\n    try {\n      const users = await UserModel.getUsersByQuery({ ...req.query });\n      responseSuccess(req, res, 200, 'Sending user data', users);\n    } catch (error) {\n      if (error instanceof Error) {\n        responseError(req, res, 400, null, error);\n      }\n    }\n  };\n\n  private addUser = async (req: express.Request, res: express.Response): Promise<void> => {\n    try {\n      const newUserDoc = new UserModel({ ...req.body });\n\n      const isDuplicate = await newUserDoc.isEmailDuplicate();\n\n      if (isDuplicate) {\n        const validationError = [{\n          value: newUserDoc.email,\n          msg: 'Email exists',\n          param: 'email',\n          location: 'body',\n        }];\n        responseError(req, res, 400, 'Email exists', validationError);\n        return;\n      }\n\n      await newUserDoc.save();\n\n      responseSuccess(req, res, 200, 'New user created');\n    } catch (error) {\n      if (error instanceof Error) {\n        responseError(req, res, 400, null, error);\n      }\n    }\n  };\n\n  static create(): express.Router {\n    if (typeof this.controller === 'undefined') {\n      this.controller = new AdminController();\n      this.controller.configure();\n    }\n    return this.controller.router;\n  }\n}\n\nexport default AdminController;\n"]}